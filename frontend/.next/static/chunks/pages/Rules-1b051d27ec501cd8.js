(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[618],{3248:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return k}});var n,a,s,l=r(29),i=r(4687),c=r.n(i),o=r(7294),u=r(7066),d=r(3454),h=d.env.REACT_APP_API_URL+"/rules",m=d.env.REACT_APP_API_KEY,p=u.Z.create({headers:{"X-API-Key":m,"Content-Type":"application/json"}}),v=(n=(0,l.Z)(c().mark(function e(){var t;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.get(h);case 3:return t=e.sent,e.abrupt("return",t.data);case 7:throw e.prev=7,e.t0=e.catch(0),Error("Failed to fetch rule sets");case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(){return n.apply(this,arguments)}),f=(a=(0,l.Z)(c().mark(function e(t){var r,n;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.post(h,t);case 3:return r=e.sent,e.abrupt("return",r.data);case 7:throw e.prev=7,e.t0=e.catch(0),Error((null===(n=e.t0.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.message)||"Failed to create rule set");case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(e){return a.apply(this,arguments)}),b=(s=(0,l.Z)(c().mark(function e(t){var r,n;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.post("".concat(h,"/parse"),{text:t});case 3:return r=e.sent,e.abrupt("return",r.data);case 7:throw e.prev=7,e.t0=e.catch(0),Error((null===(n=e.t0.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.message)||"Failed to parse rules");case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(e){return s.apply(this,arguments)}),g=r(2364),x=function(e){var t,r=e.value,n=e.onChange,a=e.onParse,s=(0,o.useState)(0),i=s[0],u=s[1],d=(0,o.useState)(!0),h=d[0],m=d[1],p=(0,o.useState)(!1),v=p[0],f=p[1];(0,o.useEffect)(function(){var e=document.getElementById("ruleEditor");e.style.height="auto",e.style.height="".concat(e.scrollHeight,"px")},[r]),(0,o.useEffect)(function(){var e=r.length;u(e);var t=/(maximum|minimum|at least|no more than)/i.test(r),n=/\d+\s+(rides?|hours?|days?|weeks?)/i.test(r),a=/(between|recovery|interval|duration)/i.test(r);m(e<=5e3&&e>=10&&t&&n&&a)},[r]);var x=(t=(0,l.Z)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b(r);case 3:a(e.sent.data.jsonRules),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Parsing failed:",e.t0);case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(){return t.apply(this,arguments)});return(0,g.BX)("div",{className:"border rounded-lg p-4 bg-white shadow-sm",children:[(0,g.BX)("div",{className:"flex justify-between items-center mb-4",children:[(0,g.tZ)("h2",{className:"text-xl font-semibold",children:"Natural Language Editor"}),(0,g.BX)("div",{className:"relative",children:[(0,g.tZ)("button",{onClick:function(){return f(!v)},className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-lg hover:bg-blue-200",children:"Templates"}),v&&(0,g.tZ)("div",{className:"absolute right-0 mt-2 w-64 bg-white border rounded-lg shadow-lg z-10",children:["Maximum 4 rides per week with at least one rest day between hard workouts","Long rides limited to 3 hours maximum during weekdays","No outdoor rides when temperature drops below 0\xb0C","Interval sessions limited to twice weekly with 48h recovery"].map(function(e,t){return(0,g.tZ)("div",{className:"p-3 hover:bg-gray-50 cursor-pointer border-b",onClick:function(){n(e),f(!1)},children:e},t)})})]})]}),(0,g.tZ)("textarea",{id:"ruleEditor",value:r,onChange:function(e){return n(e.target.value)},className:"w-full p-3 border rounded-lg focus:ring-2 ".concat(h?"focus:ring-blue-500":"focus:ring-red-500"),placeholder:"Enter your training rules in natural language...",rows:"5"}),(0,g.BX)("div",{className:"flex justify-between items-center mt-4",children:[(0,g.BX)("div",{className:"text-sm text-gray-600",children:[i,"/5000 characters •"," ",(0,g.tZ)("span",{className:h?"text-green-600":"text-red-600",children:h?"Valid":"Invalid input"})]}),(0,g.tZ)("button",{onClick:x,disabled:!h,className:"px-4 py-2 rounded-lg ".concat(h?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:"Parse Rules"})]})]})},w=r(7766),y=function(e){var t=e.rules,r=e.onSave,n=e.isSaving;return(0,g.BX)("div",{className:"border rounded-lg p-4 bg-white shadow-sm",children:[(0,g.tZ)("h2",{className:"text-xl font-semibold mb-4",children:"Rule Configuration Preview"}),(0,g.tZ)("div",{className:"border rounded-lg overflow-hidden mb-4",children:t?(0,g.tZ)(w.L,{data:t,theme:"harmonic",hideRoot:!1,shouldExpandNodeInitially:function(){return!0},style:{padding:"1rem"}}):(0,g.tZ)("div",{className:"p-4 text-gray-500",children:"Parsed rules will appear here..."})}),(0,g.tZ)("button",{onClick:r,disabled:!t||n,className:"w-full py-2 rounded-lg font-medium ".concat(t&&!n?"bg-green-600 text-white hover:bg-green-700":"bg-gray-200 text-gray-500 cursor-not-allowed"),children:n?"Saving...":"Save Rule Set"})]})},N=r(120),Z=function(e){var t,r=e.ruleSets,n=e.onSelect,a=(0,o.useState)(null),s=a[0],l=a[1];return(0,g.BX)("div",{className:"border rounded-lg p-4 bg-white shadow-sm",children:[(0,g.tZ)("h2",{className:"text-xl font-semibold mb-4",children:"Saved Rule Sets"}),0===r.length?(0,g.tZ)("div",{className:"text-gray-500 text-center py-4",children:"No rule sets saved yet. Create one using the editor above."}):(0,g.tZ)("div",{className:"overflow-x-auto",children:(0,g.BX)("table",{className:"w-full",children:[(0,g.tZ)("thead",{children:(0,g.BX)("tr",{className:"text-left border-b",children:[(0,g.tZ)("th",{className:"pb-2",children:"Name"}),(0,g.tZ)("th",{className:"pb-2",children:"Version"}),(0,g.tZ)("th",{className:"pb-2",children:"Status"}),(0,g.tZ)("th",{className:"pb-2",children:"Created"}),(0,g.tZ)("th",{className:"pb-2",children:"Actions"})]})}),(0,g.tZ)("tbody",{children:r.map(function(e){return(0,g.BX)("tr",{className:"border-b hover:bg-gray-50",children:[(0,g.tZ)("td",{className:"py-3",children:e.name||"Untitled Rules"}),(0,g.BX)("td",{className:"py-3",children:["v",e.version]}),(0,g.tZ)("td",{className:"py-3",children:(0,g.tZ)("span",{className:"px-2 py-1 rounded-full text-sm ".concat(e.active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"),children:e.active?"Active":"Inactive"})}),(0,g.tZ)("td",{className:"py-3",children:(0,N.WU)(new Date(e.created_at),"MMM dd, yyyy")}),(0,g.tZ)("td",{className:"py-3",children:(0,g.tZ)("button",{onClick:function(){l(e),n(e)},className:"text-blue-600 hover:text-blue-800",children:"View/Edit"})})]},e.id)})})]})}),s&&(0,g.tZ)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,g.BX)("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full",children:[(0,g.BX)("div",{className:"flex justify-between items-center mb-4",children:[(0,g.BX)("h3",{className:"text-lg font-semibold",children:[s.name," Version History"]}),(0,g.tZ)("button",{onClick:function(){return l(null)},className:"text-gray-500 hover:text-gray-700",children:"✕"})]}),(0,g.tZ)("div",{className:"space-y-2",children:null===(t=s.history)||void 0===t?void 0:t.map(function(e){return(0,g.tZ)("div",{className:"p-3 border rounded-lg hover:bg-gray-50",children:(0,g.BX)("div",{className:"flex justify-between items-center",children:[(0,g.BX)("div",{children:[(0,g.BX)("span",{className:"font-medium",children:["v",e.version]}),(0,g.tZ)("span",{className:"text-sm text-gray-500 ml-2",children:(0,N.WU)(new Date(e.created_at),"MMM dd, yyyy HH:mm")})]}),(0,g.tZ)("button",{onClick:function(){return n(e)},className:"text-sm text-blue-600 hover:text-blue-800",children:"Restore"})]})},e.version)})})]})})]})},k=function(){var e,t=(0,o.useState)(""),r=t[0],n=t[1],a=(0,o.useState)(null),s=a[0],i=a[1],u=(0,o.useState)([]),d=u[0],h=u[1],m=(0,o.useState)(!1),p=m[0],b=m[1],w=(0,o.useState)(""),N=w[0],k=w[1];(0,o.useEffect)(function(){var e;(e=(0,l.Z)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v();case 3:h(e.sent.data),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),k("Failed to load rule sets");case 11:case"end":return e.stop()}},e,null,[[0,8]])})),function(){return e.apply(this,arguments)})()},[]);var S=(e=(0,l.Z)(c().mark(function e(){return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return b(!0),e.prev=1,e.next=4,f({naturalLanguage:r,jsonRules:s});case 4:return n(""),i(null),e.next=8,v();case 8:h(e.sent.data),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),k("Failed to save rule set");case 16:return e.prev=16,b(!1),e.finish(16);case 19:case"end":return e.stop()}},e,null,[[1,13,16,19]])})),function(){return e.apply(this,arguments)});return(0,g.BX)("div",{className:"p-6 max-w-7xl mx-auto",children:[(0,g.tZ)("h1",{className:"text-3xl font-bold mb-6",children:"Training Rules Management"}),N&&(0,g.tZ)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:N}),(0,g.BX)("div",{className:"flex gap-6 mb-8",children:[(0,g.tZ)("div",{className:"flex-1",children:(0,g.tZ)(x,{value:r,onChange:n,onParse:i})}),(0,g.tZ)("div",{className:"flex-1",children:(0,g.tZ)(y,{rules:s,onSave:S,isSaving:p})})]}),(0,g.tZ)(Z,{ruleSets:d,onSelect:function(e){n(e.naturalLanguage),i(e.jsonRules)}})]})}},6366:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Rules",function(){return r(3248)}])}},function(e){e.O(0,[290,66,607,120,766,888,774,179],function(){return e(e.s=6366)}),_N_E=e.O()}]);