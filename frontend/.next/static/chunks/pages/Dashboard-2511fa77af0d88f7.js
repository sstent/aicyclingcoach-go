(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[156],{145:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return O}});var a=n(6835),r=n(29),s=n(4687),i=n.n(s),l=n(7294),c=n(7066),o=n(4600),d=n(2364),u=function(e){var t,n,a=e.apiKey,s=(0,l.useState)(null),u=s[0],m=s[1],h=(0,l.useState)(!1),p=h[0],f=h[1],b=(0,l.useState)(""),v=b[0],y=b[1],g=(t=(0,r.Z)(i().mark(function e(){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c.Z.get("/api/workouts/sync-status",{headers:{"X-API-Key":a}});case 3:m(e.sent.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),y("Failed to fetch sync status");case 10:case"end":return e.stop()}},e,null,[[0,7]])})),function(){return t.apply(this,arguments)}),x=(n=(0,r.Z)(i().mark(function e(){var t;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return f(!0),y(""),e.prev=2,e.next=5,c.Z.post("/api/workouts/sync",{},{headers:{"X-API-Key":a}});case 5:t=setInterval(g,2e3),setTimeout(function(){clearInterval(t),f(!1)},3e4),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),y("Failed to start sync"),f(!1);case 13:case"end":return e.stop()}},e,null,[[2,9]])})),function(){return n.apply(this,arguments)});return(0,l.useEffect)(function(){g()},[]),(0,d.BX)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,d.BX)("div",{className:"flex items-center justify-between mb-4",children:[(0,d.tZ)("h2",{className:"text-xl font-semibold",children:"Garmin Connect Sync"}),(0,d.tZ)("button",{onClick:x,disabled:p,className:"px-4 py-2 rounded-md ".concat(p?"bg-gray-300":"bg-blue-600 hover:bg-blue-700"," text-white transition-colors"),children:p?"Syncing...":"Sync Now"})]}),v&&(0,d.tZ)("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-md",children:v}),u&&(0,d.BX)("div",{className:"space-y-2",children:[(0,d.BX)("p",{className:"text-sm",children:["Last sync: ",u.last_sync_time?(0,o.Q)(new Date(u.last_sync_time))+" ago":"Never"]}),(0,d.BX)("p",{className:"text-sm",children:["Status: ",(0,d.tZ)("span",{className:"font-medium",children:u.status})]}),u.activities_synced>0&&(0,d.BX)("p",{className:"text-sm",children:["Activities synced: ",u.activities_synced]}),u.error_message&&(0,d.tZ)("p",{className:"text-sm text-red-600",children:u.error_message})]})]})},m=n(180),h=n(3196),p=n(5239),f=n(6565),b=n(7770),v=n(7098),y=n(6690),g=function(e){var t,n=e.metrics;if(!(null!=n&&null!==(t=n.time_series)&&void 0!==t&&t.length))return null;var a=n.time_series.map(function(e){return{time:new Date(e.start_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),power:e.avg_power,heartRate:e.avg_heart_rate,cadence:e.avg_cadence}});return(0,d.BX)("div",{className:"mt-6 space-y-6",children:[(0,d.BX)("div",{className:"h-64",children:[(0,d.tZ)("h4",{className:"font-medium mb-2",children:"Power Output"}),(0,d.tZ)(m.h,{width:"100%",height:"100%",children:(0,d.BX)(h.w,{data:a,children:[(0,d.tZ)(p.q,{strokeDasharray:"3 3"}),(0,d.tZ)(f.K,{dataKey:"time"}),(0,d.tZ)(b.B,{unit:"W"}),(0,d.tZ)(v.u,{}),(0,d.tZ)(y.x,{type:"monotone",dataKey:"power",stroke:"#10b981",strokeWidth:2,dot:!1})]})})]}),(0,d.BX)("div",{className:"h-64",children:[(0,d.tZ)("h4",{className:"font-medium mb-2",children:"Heart Rate"}),(0,d.tZ)(m.h,{width:"100%",height:"100%",children:(0,d.BX)(h.w,{data:a,children:[(0,d.tZ)(p.q,{strokeDasharray:"3 3"}),(0,d.tZ)(f.K,{dataKey:"time"}),(0,d.tZ)(b.B,{unit:"bpm"}),(0,d.tZ)(v.u,{}),(0,d.tZ)(y.x,{type:"monotone",dataKey:"heartRate",stroke:"#3b82f6",strokeWidth:2,dot:!1})]})})]}),(0,d.BX)("div",{className:"h-64",children:[(0,d.tZ)("h4",{className:"font-medium mb-2",children:"Cadence"}),(0,d.tZ)(m.h,{width:"100%",height:"100%",children:(0,d.BX)(h.w,{data:a,children:[(0,d.tZ)(p.q,{strokeDasharray:"3 3"}),(0,d.tZ)(f.K,{dataKey:"time"}),(0,d.tZ)(b.B,{unit:"rpm"}),(0,d.tZ)(v.u,{}),(0,d.tZ)(y.x,{type:"monotone",dataKey:"cadence",stroke:"#f59e0b",strokeWidth:2,dot:!1})]})})]})]})},x=n(8307),w=n(5792),N=function(e){var t,n=e.workout,a=e.onEdit,r=e.editable;return(0,d.BX)("div",{className:"border rounded-lg p-4 bg-white shadow-sm",children:[(0,d.BX)("div",{className:"flex justify-between items-start mb-2",children:[(0,d.tZ)("h5",{className:"font-medium capitalize",children:(null==n||null===(t=n.type)||void 0===t?void 0:t.replace("_"," "))||"Workout"}),r&&(0,d.tZ)("button",{onClick:a,className:"text-blue-600 hover:text-blue-800 text-sm",children:"Edit"})]}),(0,d.BX)("div",{className:"text-sm text-gray-600 space-y-1",children:[(0,d.BX)("div",{children:["Duration: ",(null==n?void 0:n.duration_minutes)||0," minutes"]}),(0,d.BX)("div",{children:["Intensity: ",(null==n?void 0:n.intensity)||"N/A"]}),(null==n?void 0:n.description)&&(0,d.tZ)("div",{className:"mt-2 text-gray-700",children:n.description})]})]})};function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(n),!0).forEach(function(t){(0,x.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}N.defaultProps={workout:{},onEdit:function(){},editable:!1};var X=function(e){var t=e.workout,n=e.onClose,a=e.onSave,r=(0,l.useState)({type:"",duration_minutes:0,intensity:"",description:""}),s=r[0],i=r[1];(0,l.useEffect)(function(){t&&i({type:t.type||"",duration_minutes:t.duration_minutes||0,intensity:t.intensity||"",description:t.description||""})},[t]);var c=function(e){var t=e.target,n=t.name,a=t.value;i(function(e){return k(k({},e),{},(0,x.Z)({},n,a))})};return t?(0,d.tZ)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,d.BX)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,d.tZ)("h3",{className:"text-lg font-semibold mb-4",children:"Edit Workout"}),(0,d.BX)("form",{onSubmit:function(e){e.preventDefault(),a(s)},children:[(0,d.BX)("div",{className:"space-y-4",children:[(0,d.BX)("div",{children:[(0,d.tZ)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Workout Type"}),(0,d.tZ)("input",{type:"text",name:"type",value:s.type,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,d.BX)("div",{children:[(0,d.tZ)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Duration (minutes)"}),(0,d.tZ)("input",{type:"number",name:"duration_minutes",value:s.duration_minutes,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,d.BX)("div",{children:[(0,d.tZ)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Intensity"}),(0,d.BX)("select",{name:"intensity",value:s.intensity,onChange:c,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,d.tZ)("option",{value:"",children:"Select intensity"}),(0,d.tZ)("option",{value:"zone_1",children:"Zone 1 (Easy)"}),(0,d.tZ)("option",{value:"zone_2",children:"Zone 2 (Moderate)"}),(0,d.tZ)("option",{value:"zone_3",children:"Zone 3 (Tempo)"}),(0,d.tZ)("option",{value:"zone_4",children:"Zone 4 (Threshold)"}),(0,d.tZ)("option",{value:"zone_5",children:"Zone 5 (VO2 Max)"})]})]}),(0,d.BX)("div",{children:[(0,d.tZ)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,d.tZ)("textarea",{name:"description",value:s.description,onChange:c,rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,d.BX)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,d.tZ)("button",{type:"button",onClick:n,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancel"}),(0,d.tZ)("button",{type:"submit",className:"px-4 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700",children:"Save"})]})]})]})}):null};function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}X.defaultProps={workout:null};var B=function(e){var t,n,a,s,o,u=e.plan,m=e.mode,h=void 0===m?"view":m,p=(0,w.a)().apiKey,f=(0,l.useState)(null==u?void 0:u.jsonb_plan),b=f[0],v=f[1],y=(0,l.useState)(!1),g=y[0],Z=y[1],k=(0,l.useState)(null),B=k[0],P=k[1],j=(0,l.useState)(0),O=j[0],S=j[1],D=(t=(0,r.Z)(i().mark(function e(t){var n;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach(function(t){(0,x.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},b)).weeks[O].workouts=n.weeks[O].workouts.map(function(e){return e.day===t.day?t:e}),"edit"!==h){e.next=6;break}return e.next=6,c.Z.put("/api/plans/".concat(u.id),n,{headers:{"X-API-Key":p}});case 6:v(n),Z(!1),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Error updating workout:",e.t0);case 13:case"end":return e.stop()}},e,null,[[0,10]])})),function(e){return t.apply(this,arguments)});return(0,d.BX)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,d.BX)("div",{className:"flex items-center justify-between mb-6",children:[(0,d.BX)("h3",{className:"text-xl font-semibold",children:[null==b||null===(n=b.plan_overview)||void 0===n?void 0:n.focus," Training Plan"]}),(0,d.BX)("div",{className:"text-gray-600",children:[null==b||null===(a=b.plan_overview)||void 0===a?void 0:a.duration_weeks," weeks •",null==b||null===(s=b.plan_overview)||void 0===s?void 0:s.weekly_hours," hrs/week"]})]}),(0,d.tZ)("div",{className:"space-y-8",children:null==b||null===(o=b.weeks)||void 0===o?void 0:o.map(function(e,t){return(0,d.BX)("div",{className:"border-l-2 border-blue-100 pl-4",children:[(0,d.BX)("div",{className:"flex items-center justify-between mb-4",children:[(0,d.BX)("h4",{className:"font-medium",children:["Week ",t+1,": ",e.focus]}),(0,d.BX)("div",{className:"flex items-center space-x-2",children:[(0,d.tZ)("div",{className:"h-2 w-24 bg-gray-200 rounded-full",children:(0,d.tZ)("div",{className:"h-full bg-blue-600 rounded-full",style:{width:"".concat((t+1)/b.plan_overview.duration_weeks*100,"%")}})}),(0,d.BX)("span",{className:"text-sm text-gray-600",children:[e.workouts.length," workouts"]})]})]}),(0,d.tZ)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.workouts.map(function(e,n){return(0,d.tZ)(N,{workout:e,onEdit:function(){S(t),P(e),Z(!0)},editable:"edit"===h},"".concat(t,"-").concat(n))})})]},t)})}),g&&(0,d.tZ)(X,{workout:B,onClose:function(){return Z(!1)},onSave:D})]})},P=n(8183),j=n(3454),O=function(){var e,t=(0,w.a)(),n=t.apiKey,s=t.loading,c=(0,l.useState)([]),o=c[0],m=c[1],h=(0,l.useState)(null),p=h[0],f=h[1],b=(0,l.useState)({totalWorkouts:0,totalDistance:0}),v=b[0],y=b[1],x=(0,l.useState)(null),N=x[0],Z=x[1],k=(0,l.useState)(!0),X=k[0],_=k[1],O=(0,l.useState)(""),S=O[0],D=O[1];if((0,l.useEffect)(function(){var e;(e=(0,r.Z)(i().mark(function e(){var t,r,s,l,c,o,d,u,h,p,b,v,g;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([fetch("".concat(j.env.REACT_APP_API_URL,"/api/workouts?limit=3"),{headers:{"X-API-Key":n}}),fetch("".concat(j.env.REACT_APP_API_URL,"/api/plans/active"),{headers:{"X-API-Key":n}}),fetch("".concat(j.env.REACT_APP_API_URL,"/api/stats"),{headers:{"X-API-Key":n}}),fetch("".concat(j.env.REACT_APP_API_URL,"/api/health"),{headers:{"X-API-Key":n}})]);case 3:if(t=e.sent,s=(r=(0,a.Z)(t,4))[0],l=r[1],c=r[2],o=r[3],d=[],s.ok||d.push("Failed to fetch workouts"),l.ok||d.push("Failed to fetch plan"),c.ok||d.push("Failed to fetch stats"),o.ok||d.push("Failed to fetch health status"),!(d.length>0)){e.next=16;break}throw Error(d.join(", "));case 16:return e.next=18,Promise.all([s.json(),l.json(),c.json(),o.json()]);case 18:u=e.sent,p=(h=(0,a.Z)(u,4))[0],b=h[1],v=h[2],g=h[3],m(p.workouts||[]),f(b),y(v.workouts||{totalWorkouts:0,totalDistance:0}),Z(g),e.next=33;break;case 30:e.prev=30,e.t0=e.catch(0),D(e.t0.message);case 33:return e.prev=33,_(!1),e.finish(33);case 36:case"end":return e.stop()}},e,null,[[0,30,33,36]])})),function(){return e.apply(this,arguments)})()},[n]),X||s)return(0,d.tZ)(P.Z,{});if(S)return(0,d.tZ)("div",{className:"p-6 text-red-500",children:S});var E=(v.totalDistance/1e3).toFixed(0);return(0,d.BX)("div",{className:"p-6 max-w-7xl mx-auto space-y-8",children:[(0,d.tZ)("h1",{className:"text-3xl font-bold",children:"Training Dashboard"}),(0,d.tZ)("div",{className:"mb-8",children:(0,d.tZ)(u,{apiKey:n})}),(0,d.BX)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,d.BX)("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[(0,d.tZ)("h3",{className:"text-sm font-medium text-gray-600",children:"Total Workouts"}),(0,d.tZ)("p",{className:"text-2xl font-bold",children:v.totalWorkouts})]}),(0,d.BX)("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[(0,d.tZ)("h3",{className:"text-sm font-medium text-gray-600",children:"Total Distance"}),(0,d.BX)("p",{className:"text-2xl font-bold",children:[E," km"]})]}),(0,d.BX)("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[(0,d.tZ)("h3",{className:"text-sm font-medium text-gray-600",children:"Current Plan"}),(0,d.tZ)("p",{className:"text-2xl font-bold",children:p?"v".concat(p.version):"None"})]}),(0,d.BX)("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[(0,d.tZ)("h3",{className:"text-sm font-medium text-gray-600",children:"System Status"}),(0,d.BX)("div",{className:"flex items-center",children:[(0,d.tZ)("div",{className:"w-3 h-3 rounded-full mr-2 ".concat((null==N?void 0:N.status)==="healthy"?"bg-green-500":"bg-red-500")}),(0,d.tZ)("span",{className:"text-xl font-bold capitalize",children:(null==N?void 0:N.status)||"unknown"})]})]})]}),(0,d.BX)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 lg:gap-6",children:[(0,d.BX)("div",{className:"sm:col-span-2 space-y-3 sm:space-y-4 lg:space-y-6",children:[(0,d.BX)("div",{className:"bg-white p-4 sm:p-6 rounded-lg shadow-md",children:[(0,d.tZ)("h2",{className:"text-lg sm:text-xl font-semibold mb-3 sm:mb-4",children:"Performance Metrics"}),(0,d.tZ)(g,{workouts:o})]}),(0,d.BX)("div",{className:"bg-white p-4 sm:p-6 rounded-lg shadow-md",children:[(0,d.tZ)("h2",{className:"text-lg sm:text-xl font-semibold mb-3 sm:mb-4",children:"Recent Activities"}),o.length>0?(0,d.tZ)("div",{className:"space-y-4",children:o.map(function(e){return(0,d.tZ)("div",{className:"p-3 sm:p-4 border rounded-lg hover:bg-gray-50",children:(0,d.BX)("div",{className:"flex justify-between items-center gap-2",children:[(0,d.BX)("div",{children:[(0,d.tZ)("h3",{className:"text-sm sm:text-base font-medium",children:new Date(e.start_time).toLocaleDateString()}),(0,d.tZ)("p",{className:"text-xs sm:text-sm text-gray-600",children:e.activity_type})]}),(0,d.BX)("div",{className:"text-right",children:[(0,d.BX)("p",{className:"text-sm sm:text-base font-medium",children:[(e.distance_m/1e3).toFixed(1)," km"]}),(0,d.BX)("p",{className:"text-xs sm:text-sm text-gray-600",children:[Math.round(e.duration_seconds/60)," mins"]})]})]})},e.id)})}):(0,d.tZ)("div",{className:"text-gray-500 text-center py-4",children:"No recent activities found"})]})]}),(0,d.BX)("div",{className:"space-y-6",children:[(0,d.BX)("div",{className:"bg-white p-4 sm:p-6 rounded-lg shadow-md",children:[(0,d.tZ)("h2",{className:"text-lg sm:text-xl font-semibold mb-3 sm:mb-4",children:"Current Plan"}),p?(0,d.tZ)(B,{plan:p}):(0,d.tZ)("div",{className:"text-gray-500 text-center py-4",children:"No active training plan"})]}),(0,d.BX)("div",{className:"bg-white p-4 sm:p-6 rounded-lg shadow-md",children:[(0,d.tZ)("h2",{className:"text-lg sm:text-xl font-semibold mb-3 sm:mb-4",children:"Upcoming Workouts"}),null==p||null===(e=p.jsonb_plan.weeks[0])||void 0===e?void 0:e.workouts.map(function(e,t){return(0,d.BX)("div",{className:"p-2 sm:p-3 border-b last:border-b-0",children:[(0,d.BX)("div",{className:"flex justify-between items-center",children:[(0,d.tZ)("span",{className:"capitalize",children:e.day}),(0,d.tZ)("span",{className:"text-xs sm:text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded",children:e.type.replace("_"," ")})]}),(0,d.tZ)("p",{className:"text-xs sm:text-sm text-gray-600 mt-1",children:e.description})]},t)})]})]})]})]})}},8183:function(e,t,n){"use strict";n(7294);var a=n(2364);t.Z=function(){return(0,a.tZ)("div",{className:"flex justify-center items-center h-screen",children:(0,a.tZ)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})})}},1720:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/Dashboard",function(){return n(145)}])}},function(e){e.O(0,[650,427,651,888,774,179],function(){return e(e.s=1720)}),_N_E=e.O()}]);